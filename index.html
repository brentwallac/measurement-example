<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Freight Calculator: Buy Rate (W/M) & Margin Rate (Multiple Methods)</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

<div class="max-w-7xl mx-auto p-4 md:p-8">

  <!-- Title -->
  <h2 class="text-3xl md:text-4xl font-bold text-center mb-8">
    Freight Buy Rate Calculator
    <br/>
    <span class="text-lg">
      Buy Rate = W/M; Margin Rate = Selected Rule
    </span>
  </h2>

  <!-- Tab Buttons -->
  <div class="flex space-x-4 justify-center mb-6">
    <button
      class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded"
      onclick="showTab('calculatorTab')"
    >
      Calculator
    </button>
    <button
      class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded"
      onclick="showTab('devCheatSheetTab')"
    >
      Developer Cheat Sheet
    </button>
  </div>

  <!-- CALCULATOR TAB -->
  <div id="calculatorTab" class="tabContent">

    <!-- Grid Layout -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

      <!-- Left Column: Inputs -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">Enter Shipment Details</h3>

        <!-- Freight Type -->
        <label class="block font-medium mb-1">Freight Type:</label>
        <select id="freightType" class="w-full p-2 border rounded mb-4">
          <option value="lcl">Sea Freight (LCL / Ocean)</option>
          <option value="air">Air Freight</option>
        </select>

        <!-- Dimensions (m) -->
        <label class="block font-medium mb-1">Dimensions (in meters):</label>
        <div class="flex space-x-2 mb-4">
          <input
            type="number"
            id="length"
            step="0.01"
            placeholder="Length (m)"
            class="w-1/3 p-2 border rounded"
          />
          <input
            type="number"
            id="width"
            step="0.01"
            placeholder="Width (m)"
            class="w-1/3 p-2 border rounded"
          />
          <input
            type="number"
            id="height"
            step="0.01"
            placeholder="Height (m)"
            class="w-1/3 p-2 border rounded"
          />
        </div>

        <!-- Weight (kg) -->
        <label class="block font-medium mb-1">Actual Weight (in kilograms):</label>
        <input
          type="number"
          id="weight"
          placeholder="Enter weight (kg)"
          class="w-full p-2 border rounded mb-4"
        />

        <!-- Margin Rule -->
        <label class="block font-medium mb-1">
          Margin Rule (Method):
        </label>
        <select id="marginRule" class="w-full p-2 border rounded mb-4">
          <option value="CW_1_TO_3">Cargo Weight 1 to 3 (1 CBM = 333 kg)</option>
          <option value="CW_1_TO_6">Cargo Weight 1 to 6 (1 CBM = 167 kg)</option>
          <option value="M">Per Cubic Meter (M)</option>
          <option value="W/M">Weight or Measure (W/M)</option>
          <option value="PER_KG">Per KG (actual kilograms)</option>
          <option value="PER_W">Per Weight (metric tons)</option>
          <option value="PER_M">Per Measure (CBM)</option>
        </select>

        <!-- Buy Rate & Margin Rate -->
        <label class="block font-medium mb-1">
          Buy Rate (USD per W/M unit):
        </label>
        <input
          type="number"
          id="buyRate"
          placeholder="Enter buy rate"
          class="w-full p-2 border rounded mb-4"
        />

        <label class="block font-medium mb-1">
          Margin Rate (USD per selected rule):
        </label>
        <input
          type="number"
          id="marginRate"
          placeholder="Enter margin rate"
          class="w-full p-2 border rounded mb-4"
        />

        <!-- Calculate Button -->
        <button
          onclick="calculateFreightCost()"
          class="w-full bg-blue-600 text-white p-2 rounded font-medium hover:bg-blue-700"
        >
          Calculate
        </button>
      </div>

      <!-- Middle Column: Calculation Breakdown -->
      <div class="bg-gray-50 p-6 rounded-lg shadow-md md:col-span-1 lg:col-span-2">
        <h3 class="text-xl font-semibold mb-4">Calculation Breakdown</h3>
        <pre
          id="calculationBreakdown"
          class="text-sm bg-gray-200 p-4 rounded whitespace-pre-wrap mb-4"
        ></pre>

        <!-- ELI5 Button & Explanation -->
        <button
          id="eli5Btn"
          class="bg-green-600 hover:bg-green-700 text-white font-medium px-3 py-2 rounded mb-2"
          onclick="toggleELI5()"
        >
          Show Simple Explanation
        </button>
        <pre
          id="ELI5Explanation"
          class="text-sm bg-green-100 p-3 rounded whitespace-pre-wrap hidden"
        ></pre>
      </div>

      <!-- Right Column: Results -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">Results</h3>

        <p>
          <strong title="Units used for the Buy Rate: W/M approach." class="cursor-help">
            Buy Rate Units (W/M):
          </strong>
          <span id="buyUnitsDisplay">0</span>
        </p>

        <p>
          <strong title="Units used for the Margin cost, based on the selected rule." class="cursor-help">
            Margin Units:
          </strong>
          <span id="marginUnitsDisplay">0</span>
        </p>

        <hr class="my-2"/>

        <p>
          <strong>Provider Buy Rate Cost:</strong>
          <span id="buyRateCost">$0</span>
        </p>
        <p>
          <strong>Your Margin Cost:</strong>
          <span id="marginCost">$0</span>
        </p>

        <p class="font-semibold text-lg mt-2">
          <strong>Total Freight Cost:</strong> 
          <span id="totalCost">$0</span>
        </p>
      </div>
    </div>
  </div> <!-- End calculatorTab -->

  <!-- DEVELOPER CHEAT SHEET TAB -->
  <div id="devCheatSheetTab" class="tabContent hidden bg-white p-6 rounded-lg shadow-md">
    <h3 class="text-2xl font-semibold mb-4">Developer Cheat Sheet</h3>

    <p class="mb-4">
      This page explains the core formulas used throughout the calculator.
    </p>

    <ol class="list-decimal list-inside space-y-4 text-sm">
      <li>
        <strong>Cubic Meters (CBM)</strong><br/>
        Formula: <code>CBM = Length (m) × Width (m) × Height (m)</code><br/>
        Example: if Length=2.0, Width=1.5, Height=1.0 (all in meters), then 
        CBM = <code>2.0 × 1.5 × 1.0 = 3.0</code>.
      </li>

      <li>
        <strong>Metric Tons (MT)</strong><br/>
        Formula: <code>Weight (kg) ÷ 1000</code><br/>
        Example: if the cargo weighs 1500 kg, that’s 
        <code>1500 ÷ 1000 = 1.5 MT</code>.
      </li>

      <li>
        <strong>Air Freight Volumetric Weight</strong><br/>
        If Freight Type = “Air,” we calculate volumetric weight (in kg) via 
        <code>(Length_cm × Width_cm × Height_cm) ÷ 6000</code>, then convert 
        to metric tons by dividing by 1000. We compare this volumetric value 
        to the actual weight and use whichever is higher for the “weight side.”
      </li>

      <li>
        <strong>Weight or Measure (W/M)</strong><br/>
        Under W/M, compare weight (in MT) vs. volume (in CBM), and pick the 
        larger number as the chargeable unit.
      </li>

      <li>
        <strong>Margin Methods:</strong><br/>
        <ul class="list-disc ml-6">
          <li>
            <strong>CW_1_TO_3</strong> → 1 CBM = 333 kg 
            (so CBM × 333 kg, then compare to actual weight).
          </li>
          <li>
            <strong>CW_1_TO_6</strong> → 1 CBM = 167 kg
            (so CBM × 167 kg, then compare to actual weight).
          </li>
          <li>
            <strong>M (Per Cubic Meter)</strong> → uses only CBM, ignores weight.
          </li>
          <li>
            <strong>W/M</strong> → standard “Weight or Measure” comparison.
          </li>
          <li>
            <strong>PER_KG</strong> → purely actual weight in kilograms.
          </li>
          <li>
            <strong>PER_W (metric tons)</strong> → uses weight in MT, 
            and if Air Freight, may compare with volumetric tons.
          </li>
          <li>
            <strong>PER_M (CBM)</strong> → purely the measured CBM.
          </li>
        </ul>
      </li>

      <li>
        <strong>Total Cost</strong><br/>
        We split costs into “Buy Rate” (always W/M) and “Margin Rate” 
        (the chosen rule). Then:
        <br/>
        <code>
          Buy Rate Cost = (Buy Rate Units) × (Buy Rate)</code><br/>
        <code>
          Margin Cost = (Margin Units) × (Margin Rate)</code><br/>
        <code>
          Total Freight Cost = Buy Rate Cost + Margin Cost</code>
      </li>
    </ol>
  </div> <!-- End devCheatSheetTab -->
</div> <!-- End container -->

<script>
  /**
   * Toggle the Simple Explanation (ELI5)
   */
  function toggleELI5() {
    const eli5Box = document.getElementById("ELI5Explanation");
    eli5Box.classList.toggle("hidden");
  }

  /**
   * Show/Hide Tabs
   */
  function showTab(tabId) {
    // Hide all tabContent
    document.querySelectorAll('.tabContent').forEach((el) => {
      el.classList.add('hidden');
    });
    // Show the selected tab
    document.getElementById(tabId).classList.remove('hidden');
  }

  <script>
  function calculateFreightCost() {
    // 1) Gather inputs
    const length = parseFloat(document.getElementById("length").value);
    const width = parseFloat(document.getElementById("width").value);
    const height = parseFloat(document.getElementById("height").value);
    const weightKG = parseFloat(document.getElementById("weight").value);

    const freightType = document.getElementById("freightType").value;
    const marginRule = document.getElementById("marginRule").value;

    const buyRate = parseFloat(document.getElementById("buyRate").value);
    const marginRate = parseFloat(document.getElementById("marginRate").value);

    // Basic validation
    if (
      isNaN(length) || isNaN(width) || isNaN(height) ||
      isNaN(weightKG) || isNaN(buyRate) || isNaN(marginRate)
    ) {
      alert("Please fill in all fields with valid numbers.");
      return;
    }

    // We'll accumulate a multi-step breakdown
    let breakdownText = "";
    const addLine = (str) => {
      breakdownText += str + "\n\n"; // separate lines with double newlines
    };

    // --------------------------------------------------------------------
    // STEP A: Common Calculations
    // --------------------------------------------------------------------
    addLine("STEP A: Preliminary Calculations");

    // Volume in CBM
    // Formula: Volume (m^3) = Length × Width × Height
    const measureSideCBM = length * width * height;
    addLine(`1) Volume (CBM) Calculation:
   Formula: Volume = L × W × H
   => ${length} × ${width} × ${height}
   => ${measureSideCBM.toFixed(3)} m³`);

    // Actual weight in metric tons
    // Formula: Weight (MT) = weightKG ÷ 1000
    const actualWeightTons = weightKG / 1000;
    addLine(`2) Actual Weight in Metric Tons:
   Formula: Weight (MT) = weightKG ÷ 1000
   => ${weightKG} ÷ 1000
   => ${actualWeightTons.toFixed(3)} MT`);

    // We'll also define a helper for volumetric if freightType = "air"
    function getVolumetricTons() {
      // Convert meters to centimeters
      const lengthCM = length * 100;
      const widthCM = width * 100;
      const heightCM = height * 100;
      // Volumetric formula: (L_cm × W_cm × H_cm) ÷ 6000 => in kg
      const volumeCC = lengthCM * widthCM * heightCM;
      const volumetricKG = volumeCC / 6000;
      // Convert to metric tons
      return volumetricKG / 1000;
    }

    // --------------------------------------------------------------------
    // STEP B: BUY RATE (Always W/M)
    // --------------------------------------------------------------------
    addLine("STEP B: Buy Rate Calculation (W/M)");

    // Start with weight side = actualWeightTons
    let buyWeightSide = actualWeightTons;
    addLine(`1) Weight side (MT) starts as Actual Weight:
   => ${buyWeightSide.toFixed(3)} MT`);

    // If air, compare volumetric
    if (freightType === "air") {
      addLine(`2) Air Freight => Compare Volumetric Weight to Actual Weight:
   Formula: volumetricKG = (L_cm × W_cm × H_cm) ÷ 6000
   Then volumetricTons = volumetricKG ÷ 1000`);

      const volTons = getVolumetricTons();
      addLine(`   => volumetricTons = ${volTons.toFixed(3)} MT
   Compare vs actualWeightTons = ${buyWeightSide.toFixed(3)} MT`);

      if (volTons > buyWeightSide) {
        buyWeightSide = volTons;
        addLine(`   => Using volumetricTons = ${buyWeightSide.toFixed(3)} (it's bigger)`);
      } else {
        addLine("   => Keeping actual weight (it's bigger).");
      }
    } else {
      addLine("2) Not air => skip volumetric check for Buy Rate.");
    }

    // Now compare buyWeightSide to measureSideCBM
    addLine(`3) Compare Weight side vs Volume:
   Weight side (MT) = ${buyWeightSide.toFixed(3)}
   Volume (m³)      = ${measureSideCBM.toFixed(3)}
   W/M picks whichever is bigger.`);

    const buyRateUnits = Math.max(buyWeightSide, measureSideCBM);
    addLine(`   => buyRateUnits = ${buyRateUnits.toFixed(3)}`);

    // Multiply by buyRate
    const buyRateCost = buyRateUnits * buyRate;
    addLine(`4) Buy Rate Cost:
   Buy Rate Cost = buyRateUnits × buyRate
                 = ${buyRateUnits.toFixed(3)} × $${buyRate}
                 = $${buyRateCost.toFixed(2)}`);

    // --------------------------------------------------------------------
    // STEP C: Margin Rate (Selected Rule)
    // --------------------------------------------------------------------
    addLine("STEP C: Margin Rate Calculation (Selected Rule)");
    let marginUnits = 0;

    // We'll define a small helper for applying air volumetric if needed
    function applyAirCheck(baseWeightTons) {
      if (freightType === "air") {
        addLine(`   Compare baseWeightTons (${baseWeightTons.toFixed(3)} MT) vs. volumetricTons...`);
        const volTons = getVolumetricTons();
        addLine(`   => volumetricTons = ${volTons.toFixed(3)} MT`);
        if (volTons > baseWeightTons) {
          addLine(`   => volumetric is bigger => use ${volTons.toFixed(3)}`);
          return volTons;
        } else {
          addLine(`   => keep ${baseWeightTons.toFixed(3)} MT`);
          return baseWeightTons;
        }
      } else {
        addLine("   Not air => skip volumetric for margin side.");
        return baseWeightTons;
      }
    }

    switch (marginRule) {
      case "CW_1_TO_3": {
        addLine("Rule: CW_1_TO_3 => 1 CBM = 333 kg => 0.333 MT per CBM");
        const ratioTons = (measureSideCBM * 333) / 1000;
        addLine(`   ratioTons = (CBM × 333) ÷ 1000
               = ${ratioTons.toFixed(3)} MT
   Compare vs actualWeightTons (${actualWeightTons.toFixed(3)}) => pick bigger.`);

        let weightSide = Math.max(ratioTons, actualWeightTons);
        addLine(`   => weightSide = ${weightSide.toFixed(3)} MT`);
        weightSide = applyAirCheck(weightSide);

        addLine(`   Finally compare weightSide vs. measureSideCBM => marginUnits.`);
        marginUnits = Math.max(weightSide, measureSideCBM);
        addLine(`   => marginUnits = ${marginUnits.toFixed(3)}`);
        break;
      }

      case "CW_1_TO_6": {
        addLine("Rule: CW_1_TO_6 => 1 CBM = 167 kg => 0.167 MT per CBM");
        const ratioTons = (measureSideCBM * 167) / 1000;
        addLine(`   ratioTons = (CBM × 167) ÷ 1000
               = ${ratioTons.toFixed(3)} MT`);

        let weightSide = Math.max(ratioTons, actualWeightTons);
        addLine(`   => weightSide = ${weightSide.toFixed(3)} MT (bigger of ratio or actual)`);
        weightSide = applyAirCheck(weightSide);

        marginUnits = Math.max(weightSide, measureSideCBM);
        addLine(`   => marginUnits = ${marginUnits.toFixed(3)}`);
        break;
      }

      case "M": {
        addLine("Rule: M => purely per cubic meter (CBM).");
        marginUnits = measureSideCBM;
        addLine(`   => marginUnits = ${marginUnits.toFixed(3)} m³`);
        break;
      }

      case "W/M": {
        addLine("Rule: W/M => compare weight side (MT) vs. volume (CBM). If air, check volumetric.");
        let wSide = applyAirCheck(actualWeightTons);
        marginUnits = Math.max(wSide, measureSideCBM);
        addLine(`   => marginUnits = ${marginUnits.toFixed(3)}`);
        break;
      }

      case "PER_KG": {
        addLine("Rule: Per KG => purely actual weight in kilograms (no volume).");
        marginUnits = weightKG;
        addLine(`   => marginUnits = ${weightKG} kg`);
        break;
      }

      case "PER_W": {
        addLine("Rule: Per W => purely weight in MT, possibly air volumetric.");
        let wTons = applyAirCheck(actualWeightTons);
        marginUnits = wTons;
        addLine(`   => marginUnits = ${marginUnits.toFixed(3)} MT`);
        break;
      }

      case "PER_M": {
        addLine("Rule: Per M => purely volume in CBM, ignoring weight.");
        marginUnits = measureSideCBM;
        addLine(`   => marginUnits = ${marginUnits.toFixed(3)} m³`);
        break;
      }
    }

    const marginCost = marginUnits * marginRate;
    addLine(`2) Margin Cost = marginUnits × marginRate
           = ${marginUnits.toFixed(3)} × $${marginRate}
           = $${marginCost.toFixed(2)}`);

    // --------------------------------------------------------------------
    // STEP D: Final Totals
    // --------------------------------------------------------------------
    addLine("STEP D: Final Totals");

    const totalCost = buyRateCost + marginCost;
    addLine(`1) Buy Rate Cost = $${buyRateCost.toFixed(2)}
2) Margin Cost = $${marginCost.toFixed(2)}
=> Total Freight Cost = $${totalCost.toFixed(2)}`);

    // ELI5 Explanation
    const simplifiedText = `
We do W/M for the Buy Rate, meaning we compare weight (in metric tons) 
or volumetric if air, against volume (CBM). Whichever is bigger is our 
“Buy Rate Units.” For the Margin, we apply whichever rule you selected 
(1:3, 1:6, per KG, etc.). Finally, we add the Buy Rate Cost + Margin Cost.
    `.trim();

    // Update the UI
    document.getElementById("calculationBreakdown").textContent = breakdownText.trim();
    document.getElementById("ELI5Explanation").textContent = simplifiedText;
    document.getElementById("ELI5Explanation").classList.add("hidden");

    // For the Results Panel
    document.getElementById("buyUnitsDisplay").textContent = buyRateUnits.toFixed(3);
    document.getElementById("marginUnitsDisplay").textContent = marginUnits.toFixed(3);
    document.getElementById("buyRateCost").textContent = `$${buyRateCost.toFixed(2)}`;
    document.getElementById("marginCost").textContent = `$${marginCost.toFixed(2)}`;
    document.getElementById("totalCost").textContent = `$${totalCost.toFixed(2)}`;
  }
</script>
</script>

</body>
</html>
